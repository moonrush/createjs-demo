<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irregular Area demo</title>

    <link href="../_assets/css/shared.css" rel="stylesheet" type="text/css" />

    <script src="../lib/easeljs-NEXT.js"></script>
    <script src="../lib/preloadjs-NEXT.min.js"></script>
</head>

<body onload="init()">
    <header class="Nora7aki">
        <h1>在地图上叠加不规则区域 Irregular Area</h1>

        <p>
            利用图片设置底图。封装<code>irregular.js</code>，可根据Illustrator导出<code>svg</code>的<code>polygon</code>标签数据绘制不规则区域
        </p>
    </header>

    <div class="content" style="overflow: hidden;width: 960px;height: 400px">
        <canvas id="examCanvas" width="960" height="400"></canvas>
    </div>

    <script src="irregular.js"></script>
    <script>
        let stage, loader
        let points = `405.78,47.5 401.98,47.5 380.43,51.87 374.73,56.87 370.29,60.62 368.39,61.24 362.69,63.12 
		355.72,68.74 346.85,69.99 344.95,71.24 343.04,77.49 340.51,77.49 338.61,75.61 321.5,75.61 339.24,103.1 340.51,106.23 
		339.24,110.6 336.71,114.97 336.07,117.47 336.71,121.22 337.34,123.72 336.71,126.22 334.81,128.09 334.17,130.59 334.81,133.09 
		337.34,136.22 338.61,138.71 338.61,141.21 329.1,153.08 328.47,154.96 328.47,156.83 329.1,159.33 332.27,163.08 332.27,164.95 
		329.1,168.7 327.2,171.83 329.74,178.7 332.91,182.45 333.54,183.07 336.71,183.07 339.88,184.95 339.88,186.2 337.34,187.45 
		336.71,189.32 336.07,191.82 325.3,205.56 331.01,213.69 331.64,215.56 331.64,218.06 332.91,219.31 335.44,219.93 336.71,221.18 
		337.34,222.43 339.24,233.68 341.78,240.55 343.04,243.05 346.21,245.55 350.02,247.42 351.28,249.3 350.02,251.17 348.75,252.42 
		348.75,256.79 350.65,262.42 349.38,263.04 346.85,263.67 346.21,264.92 346.21,269.29 348.11,270.54 351.92,273.04 351.92,274.29 
		350.02,277.41 351.28,279.91 355.08,281.16 358.25,285.53 358.89,292.41 361.42,295.53 363.32,301.78 366.49,313.65 366.49,318.65 
		368.39,319.27 372.83,319.89 377.9,317.4 383.6,312.4 389.3,304.28 393.74,301.78 396.91,296.78 401.34,296.78 404.51,300.53 
		407.05,301.78 411.48,300.53 413.38,301.78 422.25,301.78 427.96,304.28 429.86,308.02 430.49,314.27 433.66,319.27 442.53,298.03 
		462.18,298.03 464.08,302.4 467.25,306.15 470.41,291.78 472.31,280.54 472.95,266.79 482.45,253.05 482.45,250.55 483.72,249.3 
		502.73,246.17 512.24,246.17 520.47,243.05 534.42,243.05 535.68,242.42 541.39,242.42 545.82,244.92 550.26,248.67 554.69,260.54 
		555.33,260.54 561.66,256.17 555.96,250.55 561.03,240.55 564.2,237.43 564.2,234.3 562.93,233.05 563.56,230.55 565.47,226.18 
		565.47,224.93 568,221.81 568,219.93 564.83,214.31 562.93,206.19 561.66,204.94 558.49,204.31 552.79,201.82 548.36,196.82 
		548.36,190.57 551.52,183.7 551.52,181.2 513.5,179.32 512.87,164.95 506.53,155.58 510.34,155.58 510.34,144.34 507.8,138.71 
		509.07,136.22 509.07,131.22 501.46,126.84 495.13,124.35 481.82,123.72 479.92,122.47 472.95,115.6 467.25,114.97 460.91,112.47 
		448.87,105.6 445.7,104.35 436.83,103.73 426.06,103.1 423.52,98.73 420.35,96.23 417.19,93.73 408.31,82.49 407.05,79.99 
		407.05,69.99 405.15,61.24 407.05,58.12 407.05,51.87`
        let irr

        // 初始化 & 加载数据
        const init = () => {
            stage = new createjs.Stage('examCanvas')

            loader = new createjs.LoadQueue(false)
            loader.addEventListener('complete', handleComplete)
            loader.loadManifest(
                [{
                    src: 'southa.jpg', id: 'map'
                }],
                true, '../_assets/img/'
            )
        }

        const handleComplete = () => {
            // 构建地图层
            map = new createjs.Bitmap(loader.getResult('map'))

            // 构建不规则图形
            irr = new createjs.Irregular(points,
                { x: 437, y: 200 },
                'rgba(255,255,255,0.5)', 'rgba(0,0,0,1)')

            stage.addChild(map, irr)
            stage.update()

            createjs.Ticker.timingMode = createjs.Ticker.RAF
            createjs.Ticker.addEventListener('tick', tick)
        }

        const tick = (e) => {
            irr.fill = `rgba(255,255,255,${Math.abs(e.time % 3000 / 1500 - 1)})`
            stage.update()
        }

    </script>
</body>

</html>